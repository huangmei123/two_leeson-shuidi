# chrome架构 1个页面4个进程

	1. 并行处理
	计算机在同一时刻处理多个任务。
	如计算 A、B、C 并显示结果。在单线程就会分四步走，逐个计算结果然后显示结果。在多线程分二步走，先同时计算3个结果，然后显示结果。
	2. 线程 VS 进程
	多线程可以并行处理任务，但是线程不能单独存在，它是有进程来启动和管理的。
	一个进程就是一个程序的运行实例。在启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，把这个运行环境叫做进程。
	线程依附于进程，而进程中使用多线程并行处理能提升运算效率。
	3. 进程与线程之间关系的特点：
	（1）进程中的任意线程执行出错，都会导致整个进程的崩溃
	（2）线程之间共享进程中的数据
	（3）当一个进程关闭之后，操作系统会回收进程所占用的内存。
	即使是内存泄漏 也会回收这些内存。浏览器开着内存就越多 关闭的时候这些内存就都会被系统回收掉。
	（4）进程之间的内容相互隔离。
	是为了保护操作系统中进程互不干扰的技术，如果需要进程之间通信就能使用进程间通信IPC的机制了。
	4. 单进程浏览器时代
	指的是浏览器的所有功能模块都运行在同一个进程里。
	模块包括：网络、插件、JavaScript运行环境、渲染引擎和页面。
	存在的问题：
	（1）不稳定： 早期是利用插件来实现一些强大的功能（web视频、游戏），但是插件容易出问题，一旦出现就会导致浏览器的崩溃。
	渲染引擎模块也是不稳定，一些复杂的JavaScript代码会引起渲染引擎模块的崩溃。
	（2）不流畅 ： 在同一时刻只能有一个模块可以执行。如果出现一些无线脚本 那么执行的时候就会独占整个线程，导致其他模块无法运行。会导致浏览器失去响应 变卡顿。页面的内存泄露也会导致单进程变慢：在运行一个复杂页面再关闭页面 会存在内存不能狗完全回收的情况，内存越占越高 浏览器变慢。
	（3）不安全 ： 从插件和页面脚本。
	插件可以获取到操作系统的任意资源 运行插件意味着插件操控你的电脑，如果是恶意插件 就能释放病毒、窃取账号密码引发安全性问题。
	页面脚本 可以通过漏洞来获取系统权限 。
	5. 多进程时代
	早期的多进程时代：2008年chrome chrome的页面是运行在单独的渲染进程中，插件时运行在单独的插件进程之中，进程之间时通过IPC机制进行通信。
	不稳定----> 进程之间相互隔离
	不流畅----> JavaScript即使是阻塞了渲染进程 也不会影响到其他的浏览器和页面。内存泄漏：关闭渲染进程 占用的内存都会被系统回收
	不安全------> 安全沙箱 像操作系统给系统上了一把锁，沙箱里面的程序可以运行，但是不能在硬盘中写入任何数据，也不能读取数据。像文档和桌面。
	6. 目前多进程架构
	最新的chrome浏览器包括：1个浏览器主进程、1个GPU、1个网络进程、多个渲染进程 多个插件进程
	（1）浏览器主进程 ： 主要负责页面显示、用户交互、子进程管理 、提供存储。
	（2）渲染进程：在沙箱模式下运行。 将HTML CSS JavaScript转换为用户可以与之交互的页面，排版引擎Blink 和JavaScript引擎V8 都是运行在该进程之中，默认chrome会为每一个Tab标签创建一个渲染进程 。
	（3）GPU进程 ： 初衷是为了实现3D css的效果  ，随着网页 Chrome的UI页面都采用GPU来绘制，成为普遍需求。
	（4）网络进程 ： 网络资源的加载，
	（5）插件进程 ： 负责插件的运行，因插件易崩溃需要进程来隔离。
多进程带来的问题：更高的资源占用、更复杂的体系架构
	7. 未来面向服务的架构
	2016年 chrome 使用“面向服务的架构”SOA. 原来的各种模块会被重构成独立的服务，某个服务独立独立的进程中运行，
	
	场景问题1：单个页面卡死导致整个崩溃。
	一般情况一个页面一个进程，有一种情况“同一站点（same-site）”。
	同一站点：根域名（geekbang.org) + 协议（https://或者http://），还包括子域名 不同端口：
	
	这些都是同一站点，因为协议和根域名相同。
	新页面和当前页面如果是同一站点 那么新页面会复用父页面的渲染进程，这个叫process-per-sit-instance。此时他们会被分配到同一个渲染进程中，一个崩溃 那么另一个也会崩溃。之所以在同一个进程是因为共享js的执行环境，A页面可以直接在B页面中执行脚本。
	场景问题2：定位浏览器中页面崩溃的原因？
	1.第三方插件注入浏览器或者页面进程 ，拦截正常操作 。比如杀毒软件、卫士类软件、流量劫持软件
	2.插件 （现在使用率低 应该不是大问题)
	3.浏览器的bug 如渲染引擎 JavaScript引擎 （更新升级 这类原因也低)
4.使用js来统计页面是否崩溃。（推荐)